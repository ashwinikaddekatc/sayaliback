{"version":3,"file":"ctrl-ngx-codemirror.umd.js","sources":["../../src/lib/codemirror.component.ts","../../src/lib/codemirror.module.ts","../../src/lib/ctrl-ngx-codemirror.ts"],"names":["EventEmitter","Component","NG_VALUE_ACCESSOR","forwardRef","ChangeDetectionStrategy","KeyValueDiffers","NgZone","Input","Output","ViewChild","NgModule"],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  DoCheck,\n  ElementRef,\n  EventEmitter,\n  forwardRef,\n  Input,\n  KeyValueDiffer,\n  KeyValueDiffers,\n  NgZone,\n  OnDestroy,\n  Output,\n  ViewChild,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n  Editor,\n  EditorChangeLinkedList,\n  EditorFromTextArea,\n  ScrollInfo,\n} from 'codemirror';\n\nfunction normalizeLineEndings(str: string): string {\n  if (!str) {\n    return str;\n  }\n  return str.replace(/\\r\\n|\\r/g, '\\n');\n}\n\ndeclare var require: any;\ndeclare var CodeMirror: any;\n\n@Component({\n  selector: 'ngx-codemirror',\n  template: `\n    <textarea\n      [name]=\"name\"\n      class=\"ngx-codemirror {{ className }}\"\n      [class.ngx-codemirror--focused]=\"isFocused\"\n      autocomplete=\"off\"\n      [autofocus]=\"autoFocus\"\n      #ref\n    >\n    </textarea>\n  `,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => CodemirrorComponent),\n      multi: true,\n    },\n  ],\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CodemirrorComponent\n  implements AfterViewInit, OnDestroy, ControlValueAccessor, DoCheck {\n  /* class applied to the created textarea */\n  @Input() className = '';\n  /* name applied to the created textarea */\n  @Input() name = 'codemirror';\n  /* autofocus setting applied to the created textarea */\n  @Input() autoFocus = false;\n  /**\n   * set options for codemirror\n   * @link http://codemirror.net/doc/manual.html#config\n   */\n  @Input()\n  set options(value: { [key: string]: any }) {\n    this._options = value;\n    if (!this._differ && value) {\n      this._differ = this._differs.find(value).create();\n    }\n  }\n  /* preserve previous scroll position after updating value */\n  @Input() preserveScrollPosition = false;\n  /* called when the text cursor is moved */\n  @Output() cursorActivity = new EventEmitter<Editor>();\n  /* called when the editor is focused or loses focus */\n  @Output() focusChange = new EventEmitter<boolean>();\n  /* called when the editor is scrolled */\n  // tslint:disable-next-line:no-output-native\n  @Output() scroll = new EventEmitter<ScrollInfo>();\n  /* called when file(s) are dropped */\n  // tslint:disable-next-line:no-output-native\n  @Output() drop = new EventEmitter<[Editor, DragEvent]>();\n  @ViewChild('ref', { static: true }) ref!: ElementRef;\n  value = '';\n  disabled = false;\n  isFocused = false;\n  codeMirror?: EditorFromTextArea;\n  /**\n   * either global variable or required library\n   */\n  private _codeMirror: any;\n\n  private _differ?: KeyValueDiffer<string, any>;\n  private _options: any;\n\n  constructor(private _differs: KeyValueDiffers, private _ngZone: NgZone) {}\n\n  get codeMirrorGlobal(): any {\n    if (this._codeMirror) {\n      return this._codeMirror;\n    }\n\n    this._codeMirror = typeof CodeMirror !== 'undefined' ? CodeMirror : require('codemirror');\n    return this._codeMirror;\n  }\n\n  ngAfterViewInit(): void {\n    if (!this.ref) {\n      return;\n    }\n    // in order to allow for universal rendering, we import Codemirror runtime with `require` to prevent node errors\n    this._ngZone.runOutsideAngular(() => {\n      this.codeMirror = this.codeMirrorGlobal.fromTextArea(\n        this.ref.nativeElement,\n        this._options,\n      ) as EditorFromTextArea;\n      this.codeMirror.on('cursorActivity', cm =>\n        this._ngZone.run(() => this.cursorActive(cm)),\n      );\n      this.codeMirror.on('scroll', this.scrollChanged.bind(this));\n      this.codeMirror.on('blur', () =>\n        this._ngZone.run(() => this.focusChanged(false)),\n      );\n      this.codeMirror.on('focus', () =>\n        this._ngZone.run(() => this.focusChanged(true)),\n      );\n      this.codeMirror.on(\n        'change',\n        (cm: Editor, change: EditorChangeLinkedList) =>\n          this._ngZone.run(() => this.codemirrorValueChanged(cm, change)),\n      );\n      this.codeMirror.on(\n        'drop',\n        (cm: Editor, e: DragEvent) => {\n          this._ngZone.run(() => this.dropFiles(cm, e));\n        }\n      );\n      this.codeMirror.setValue(this.value);\n    });\n  }\n  ngDoCheck(): void {\n    if (!this._differ) {\n      return;\n    }\n    // check options have not changed\n    const changes = this._differ.diff(this._options);\n    if (changes) {\n      changes.forEachChangedItem(option =>\n        this.setOptionIfChanged(option.key, option.currentValue),\n      );\n      changes.forEachAddedItem(option =>\n        this.setOptionIfChanged(option.key, option.currentValue),\n      );\n      changes.forEachRemovedItem(option =>\n        this.setOptionIfChanged(option.key, option.currentValue),\n      );\n    }\n  }\n  ngOnDestroy(): void {\n    // is there a lighter-weight way to remove the cm instance?\n    if (this.codeMirror) {\n      this.codeMirror.toTextArea();\n    }\n  }\n  codemirrorValueChanged(cm: Editor, change: EditorChangeLinkedList): void {\n    if (change.origin !== 'setValue') {\n      this.value = cm.getValue();\n      this.onChange(this.value);\n    }\n  }\n  setOptionIfChanged(optionName: string, newValue: any): void {\n    if (!this.codeMirror) {\n      return;\n    }\n\n    // cast to any to handle strictly typed option names\n    // could possibly import settings strings available in the future\n    this.codeMirror.setOption(optionName as any, newValue);\n  }\n  focusChanged(focused: boolean): void {\n    this.onTouched();\n    this.isFocused = focused;\n    this.focusChange.emit(focused);\n  }\n  scrollChanged(cm: Editor): void {\n    this.scroll.emit(cm.getScrollInfo());\n  }\n  cursorActive(cm: Editor): void {\n    this.cursorActivity.emit(cm);\n  }\n  dropFiles(cm: Editor, e: DragEvent): void {\n    this.drop.emit([cm, e]);\n  }\n  /** Implemented as part of ControlValueAccessor. */\n  writeValue(value: string): void {\n    if (value === null || value === undefined) {\n      return;\n    }\n    if (!this.codeMirror) {\n      this.value = value;\n      return;\n    }\n    const cur = this.codeMirror.getValue();\n    if (\n      value !== cur &&\n      normalizeLineEndings(cur) !== normalizeLineEndings(value)\n    ) {\n      this.value = value;\n      if (this.preserveScrollPosition) {\n        const prevScrollPosition = this.codeMirror.getScrollInfo();\n        this.codeMirror.setValue(this.value);\n        this.codeMirror.scrollTo(\n          prevScrollPosition.left,\n          prevScrollPosition.top,\n        );\n      } else {\n        this.codeMirror.setValue(this.value);\n      }\n    }\n  }\n\n  /** Implemented as part of ControlValueAccessor. */\n  registerOnChange(fn: (value: string) => void): void {\n    this.onChange = fn;\n  }\n  /** Implemented as part of ControlValueAccessor. */\n  registerOnTouched(fn: () => void): void {\n    this.onTouched = fn;\n  }\n  /** Implemented as part of ControlValueAccessor. */\n  setDisabledState(isDisabled: boolean): void {\n    this.disabled = isDisabled;\n    this.setOptionIfChanged('readOnly', this.disabled);\n  }\n  /** Implemented as part of ControlValueAccessor. */\n  private onChange = (_: any) => {};\n  /** Implemented as part of ControlValueAccessor. */\n  private onTouched = () => {};\n}\n","import { NgModule } from '@angular/core';\n\nimport { CodemirrorComponent } from './codemirror.component';\n\n@NgModule({\n  exports: [CodemirrorComponent],\n  declarations: [CodemirrorComponent],\n})\nexport class CodemirrorModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"]}