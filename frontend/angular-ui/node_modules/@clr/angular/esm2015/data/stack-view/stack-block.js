/*
 * Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
import { Component, EventEmitter, HostBinding, Inject, Input, Optional, Output, SkipSelf } from '@angular/core';
import { ClrCommonStringsService } from '../../utils/i18n/common-strings.service';
import { UNIQUE_ID, UNIQUE_ID_PROVIDER } from '../../utils/id-generator/id-generator.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../utils/i18n/common-strings.service';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '../../utils/animations/expandable-animation/expandable-animation';
import * as ɵngcc4 from '../../icon/icon';

function ClrStackBlock_cds_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "cds-icon", 7);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵattribute("direction", ctx_r0.caretDirection);
} }
function ClrStackBlock_span_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 8);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r1.commonStrings.keys.stackViewChanged);
} }
function ClrStackBlock_div_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵprojection(1, 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵstyleProp("height", ctx_r2.expanded ? "auto" : 0);
} }
const _c0 = [[["clr-stack-label"]], "*", [["clr-stack-block"]]];
const _c1 = ["clr-stack-label", "*", "clr-stack-block"];
export class ClrStackBlock {
    /*
     * This would be more efficient with @ContentChildren, with the parent ClrStackBlock
     * querying for children StackBlocks, but this feature is not available when downgrading
     * the component for Angular 1.
     */
    constructor(parent, uniqueId, commonStrings) {
        this.parent = parent;
        this.uniqueId = uniqueId;
        this.commonStrings = commonStrings;
        this.expanded = false;
        this.expandedChange = new EventEmitter(false);
        this.expandable = false;
        this.focused = false;
        this._changedChildren = 0;
        this._fullyInitialized = false;
        this._changed = false;
        if (parent) {
            parent.addChild();
        }
    }
    get getChangedValue() {
        return this._changed || (this._changedChildren > 0 && !this.expanded);
    }
    set setChangedValue(value) {
        this._changed = value;
        if (this.parent && this._fullyInitialized) {
            if (value) {
                this.parent._changedChildren++;
            }
            else {
                this.parent._changedChildren--;
            }
        }
    }
    ngOnInit() {
        // in order to access the parent ClrStackBlock's properties,
        // the child ClrStackBlock has to be fully initialized at first.
        this._fullyInitialized = true;
    }
    addChild() {
        this.expandable = true;
    }
    toggleExpand() {
        if (this.expandable) {
            this.expanded = !this.expanded;
            this.expandedChange.emit(this.expanded);
        }
    }
    get caretDirection() {
        return this.expanded ? 'down' : 'right';
    }
    get role() {
        return this.expandable ? 'button' : null;
    }
    get tabIndex() {
        return this.expandable ? '0' : null;
    }
    get onStackLabelFocus() {
        return this.expandable && !this.expanded && this.focused;
    }
    get ariaExpanded() {
        if (!this.expandable) {
            return null;
        }
        else {
            return this.expanded ? 'true' : 'false';
        }
    }
    getStackChildrenId() {
        return this.expanded ? `clr-stack-children-${this.uniqueId}` : null;
    }
}
ClrStackBlock.ɵfac = function ClrStackBlock_Factory(t) { return new (t || ClrStackBlock)(ɵngcc0.ɵɵdirectiveInject(ClrStackBlock, 12), ɵngcc0.ɵɵdirectiveInject(UNIQUE_ID), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ClrCommonStringsService)); };
ClrStackBlock.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ClrStackBlock, selectors: [["clr-stack-block"]], hostVars: 10, hostBindings: function ClrStackBlock_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("stack-block", true)("stack-block-expanded", ctx.expanded)("stack-block-expandable", ctx.expandable)("stack-block-changed", ctx.getChangedValue)("on-focus", ctx.onStackLabelFocus);
    } }, inputs: { expanded: ["clrSbExpanded", "expanded"], expandable: ["clrSbExpandable", "expandable"], setChangedValue: ["clrSbNotifyChange", "setChangedValue"], ariaLevel: ["clrStackViewLevel", "ariaLevel"], ariaSetsize: ["clrStackViewSetsize", "ariaSetsize"], ariaPosinset: ["clrStackViewPosinset", "ariaPosinset"] }, outputs: { expandedChange: "clrSbExpandedChange" }, features: [ɵngcc0.ɵɵProvidersFeature([UNIQUE_ID_PROVIDER])], ngContentSelectors: _c1, decls: 9, vars: 13, consts: [[1, "stack-block-label", 3, "id", "click", "keyup.enter", "keyup.space", "focus", "blur"], ["shape", "angle", "class", "stack-block-caret", 4, "ngIf"], ["class", "clr-sr-only", 4, "ngIf"], [1, "stack-view-key"], [1, "stack-block-content"], [1, "stack-children", 3, "clrExpandTrigger"], ["role", "region", 3, "height", 4, "ngIf"], ["shape", "angle", 1, "stack-block-caret"], [1, "clr-sr-only"], ["role", "region"]], template: function ClrStackBlock_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c0);
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵlistener("click", function ClrStackBlock_Template_div_click_0_listener() { return ctx.toggleExpand(); })("keyup.enter", function ClrStackBlock_Template_div_keyup_enter_0_listener() { return ctx.toggleExpand(); })("keyup.space", function ClrStackBlock_Template_div_keyup_space_0_listener() { return ctx.toggleExpand(); })("focus", function ClrStackBlock_Template_div_focus_0_listener() { return ctx.focused = true; })("blur", function ClrStackBlock_Template_div_blur_0_listener() { return ctx.focused = false; });
        ɵngcc0.ɵɵtemplate(1, ClrStackBlock_cds_icon_1_Template, 1, 1, "cds-icon", 1);
        ɵngcc0.ɵɵtemplate(2, ClrStackBlock_span_2_Template, 2, 1, "span", 2);
        ɵngcc0.ɵɵelementStart(3, "div", 3);
        ɵngcc0.ɵɵprojection(4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "div", 4);
        ɵngcc0.ɵɵprojection(6, 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "clr-expandable-animation", 5);
        ɵngcc0.ɵɵtemplate(8, ClrStackBlock_div_8_Template, 2, 2, "div", 6);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("id", ctx.uniqueId);
        ɵngcc0.ɵɵattribute("role", ctx.role)("tabindex", ctx.tabIndex)("aria-expanded", ctx.ariaExpanded)("aria-controls", ctx.getStackChildrenId())("aria-posinset", ctx.ariaPosinset)("aria-level", ctx.ariaLevel)("aria-setsize", ctx.ariaSetsize);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expandable);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.getChangedValue);
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("clrExpandTrigger", ctx.expanded);
        ɵngcc0.ɵɵattribute("id", ctx.getStackChildrenId());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expanded);
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.ClrExpandableAnimation, ɵngcc4.CdsIconCustomTag], styles: ["[_nghost-%COMP%] {\n        display: block;\n      }"] });
ClrStackBlock.ctorParameters = () => [
    { type: ClrStackBlock, decorators: [{ type: SkipSelf }, { type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [UNIQUE_ID,] }] },
    { type: ClrCommonStringsService }
];
ClrStackBlock.propDecorators = {
    expanded: [{ type: HostBinding, args: ['class.stack-block-expanded',] }, { type: Input, args: ['clrSbExpanded',] }],
    expandedChange: [{ type: Output, args: ['clrSbExpandedChange',] }],
    expandable: [{ type: HostBinding, args: ['class.stack-block-expandable',] }, { type: Input, args: ['clrSbExpandable',] }],
    getChangedValue: [{ type: HostBinding, args: ['class.stack-block-changed',] }],
    setChangedValue: [{ type: Input, args: ['clrSbNotifyChange',] }],
    ariaLevel: [{ type: Input, args: ['clrStackViewLevel',] }],
    ariaSetsize: [{ type: Input, args: ['clrStackViewSetsize',] }],
    ariaPosinset: [{ type: Input, args: ['clrStackViewPosinset',] }],
    onStackLabelFocus: [{ type: HostBinding, args: ['class.on-focus',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ClrStackBlock, [{
        type: Component,
        args: [{
                selector: 'clr-stack-block',
                template: `
    <div
      class="stack-block-label"
      (click)="toggleExpand()"
      (keyup.enter)="toggleExpand()"
      (keyup.space)="toggleExpand()"
      (focus)="focused = true"
      (blur)="focused = false"
      [id]="uniqueId"
      [attr.role]="role"
      [attr.tabindex]="tabIndex"
      [attr.aria-expanded]="ariaExpanded"
      [attr.aria-controls]="getStackChildrenId()"
      [attr.aria-posinset]="ariaPosinset"
      [attr.aria-level]="ariaLevel"
      [attr.aria-setsize]="ariaSetsize"
    >
      <cds-icon shape="angle" class="stack-block-caret" *ngIf="expandable" [attr.direction]="caretDirection"></cds-icon>
      <span class="clr-sr-only" *ngIf="getChangedValue">{{ commonStrings.keys.stackViewChanged }}</span>
      <div class="stack-view-key">
        <!-- This structure changed to fix #3567 and the a11y request was to move away from dl's -->
        <!-- I added the key class to update css targets for the original component style -->
        <ng-content select="clr-stack-label"></ng-content>
      </div>
      <div class="stack-block-content">
        <ng-content></ng-content>
      </div>
    </div>

    <clr-expandable-animation [clrExpandTrigger]="expanded" class="stack-children" [attr.id]="getStackChildrenId()">
      <div [style.height]="expanded ? 'auto' : 0" role="region" *ngIf="expanded">
        <ng-content select="clr-stack-block"></ng-content>
      </div>
    </clr-expandable-animation>
  `,
                // Make sure the host has the proper class for styling purposes
                host: { '[class.stack-block]': 'true' },
                providers: [UNIQUE_ID_PROVIDER],
                styles: [`
      :host {
        display: block;
      }
    `]
            }]
    }], function () { return [{ type: ClrStackBlock, decorators: [{
                type: SkipSelf
            }, {
                type: Optional
            }] }, { type: String, decorators: [{
                type: Inject,
                args: [UNIQUE_ID]
            }] }, { type: ɵngcc1.ClrCommonStringsService }]; }, { expanded: [{
            type: HostBinding,
            args: ['class.stack-block-expanded']
        }, {
            type: Input,
            args: ['clrSbExpanded']
        }], expandedChange: [{
            type: Output,
            args: ['clrSbExpandedChange']
        }], expandable: [{
            type: HostBinding,
            args: ['class.stack-block-expandable']
        }, {
            type: Input,
            args: ['clrSbExpandable']
        }], getChangedValue: [{
            type: HostBinding,
            args: ['class.stack-block-changed']
        }], setChangedValue: [{
            type: Input,
            args: ['clrSbNotifyChange']
        }], onStackLabelFocus: [{
            type: HostBinding,
            args: ['class.on-focus']
        }], ariaLevel: [{
            type: Input,
            args: ['clrStackViewLevel']
        }], ariaSetsize: [{
            type: Input,
            args: ['clrStackViewSetsize']
        }], ariaPosinset: [{
            type: Input,
            args: ['clrStackViewPosinset']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhY2stYmxvY2suanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Nsci1hbmd1bGFyL3NyYy9kYXRhL3N0YWNrLXZpZXcvc3RhY2stYmxvY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQVUsUUFBUSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1EOUYsTUFBTSxPQUFPLGFBQWE7QUFBRyxJQStDM0I7QUFDRjtBQUNFO0FBQ0U7QUFFSixPQURLO0FBQ0wsSUFBRSxZQUdVLE1BQXFCLEVBQ0gsUUFBZ0IsRUFDbkMsYUFBc0M7QUFDOUMsUUFIUyxXQUFNLEdBQU4sTUFBTSxDQUFlO0FBQUMsUUFDSixhQUFRLEdBQVIsUUFBUSxDQUFRO0FBQUMsUUFDcEMsa0JBQWEsR0FBYixhQUFhLENBQXlCO0FBQ2pELFFBdkRFLGFBQVEsR0FBRyxLQUFLLENBQUM7QUFDbkIsUUFBaUMsbUJBQWMsR0FBMEIsSUFBSSxZQUFZLENBQVUsS0FBSyxDQUFDLENBQUM7QUFDMUcsUUFFRSxlQUFVLEdBQUcsS0FBSyxDQUFDO0FBQ3JCLFFBQ0UsWUFBTyxHQUFHLEtBQUssQ0FBQztBQUNsQixRQUFVLHFCQUFnQixHQUFHLENBQUMsQ0FBQztBQUMvQixRQUFVLHNCQUFpQixHQUFHLEtBQUssQ0FBQztBQUNwQyxRQUFVLGFBQVEsR0FBRyxLQUFLLENBQUM7QUFDM0IsUUE4Q0ksSUFBSSxNQUFNLEVBQUU7QUFDaEIsWUFBTSxNQUFN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Q3ZDLFNBQVMsRUFBRSxDQUFDLGtCQUFrQixDQUFDLDJCQVI3QixxREFJQyxlQUtKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2dLQUNJO0FBQUM7QUFBdUMsWUF1RHpCLGFBQWEsdUJBRjVCLFFBQVEsWUFDUixRQUFRO0FBQ1QseUNBQ0MsTUFBTSxTQUFDLFNBQVM7QUFBUyxZQTVHckIsdUJBQXVCO0FBQUc7QUFBRztBQUFpQyx1QkFxRHBFLFdBQVcsU0FBQyw0QkFBNEIsY0FDeEMsS0FBSyxTQUFDLGVBQWU7QUFDbkIsNkJBQ0YsTUFBTSxTQUFDLHFCQUFxQjtBQUFPLHlCQUNuQyxXQUFXLFNBQUMsOEJBQThCLGNBQzFDLEtBQUssU0FBQyxpQkFBaUI7QUFDckIsOEJBT0YsV0FBVyxTQUFDLDJCQUEyQjtBQUNyQyw4QkFJRixLQUFLLFNBQUMsbUJBQW1CO0FBQ3ZCLHdCQWVGLEtBQUssU0FBQyxtQkFBbUI7QUFBTywwQkFLaEMsS0FBSyxTQUFDLHFCQUFxQjtBQUFPLDJCQUtsQyxLQUFLLFNBQUMsc0JBQXNCO0FBQU8sZ0NBZ0RuQyxXQUFXLFNBQUMsZ0JBQWdCO0FBQzNCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgMjAxNi0yMDIwIFZNd2FyZSwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogVGhpcyBzb2Z0d2FyZSBpcyByZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZS5cbiAqIFRoZSBmdWxsIGxpY2Vuc2UgaW5mb3JtYXRpb24gY2FuIGJlIGZvdW5kIGluIExJQ0VOU0UgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgcHJvamVjdC5cbiAqL1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBJbmplY3QsIElucHV0LCBPbkluaXQsIE9wdGlvbmFsLCBPdXRwdXQsIFNraXBTZWxmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDbHJDb21tb25TdHJpbmdzU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2kxOG4vY29tbW9uLXN0cmluZ3Muc2VydmljZSc7XG5pbXBvcnQgeyBVTklRVUVfSUQsIFVOSVFVRV9JRF9QUk9WSURFUiB9IGZyb20gJy4uLy4uL3V0aWxzL2lkLWdlbmVyYXRvci9pZC1nZW5lcmF0b3Iuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Nsci1zdGFjay1ibG9jaycsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJzdGFjay1ibG9jay1sYWJlbFwiXG4gICAgICAoY2xpY2spPVwidG9nZ2xlRXhwYW5kKClcIlxuICAgICAgKGtleXVwLmVudGVyKT1cInRvZ2dsZUV4cGFuZCgpXCJcbiAgICAgIChrZXl1cC5zcGFjZSk9XCJ0b2dnbGVFeHBhbmQoKVwiXG4gICAgICAoZm9jdXMpPVwiZm9jdXNlZCA9IHRydWVcIlxuICAgICAgKGJsdXIpPVwiZm9jdXNlZCA9IGZhbHNlXCJcbiAgICAgIFtpZF09XCJ1bmlxdWVJZFwiXG4gICAgICBbYXR0ci5yb2xlXT1cInJvbGVcIlxuICAgICAgW2F0dHIudGFiaW5kZXhdPVwidGFiSW5kZXhcIlxuICAgICAgW2F0dHIuYXJpYS1leHBhbmRlZF09XCJhcmlhRXhwYW5kZWRcIlxuICAgICAgW2F0dHIuYXJpYS1jb250cm9sc109XCJnZXRTdGFja0NoaWxkcmVuSWQoKVwiXG4gICAgICBbYXR0ci5hcmlhLXBvc2luc2V0XT1cImFyaWFQb3NpbnNldFwiXG4gICAgICBbYXR0ci5hcmlhLWxldmVsXT1cImFyaWFMZXZlbFwiXG4gICAgICBbYXR0ci5hcmlhLXNldHNpemVdPVwiYXJpYVNldHNpemVcIlxuICAgID5cbiAgICAgIDxjZHMtaWNvbiBzaGFwZT1cImFuZ2xlXCIgY2xhc3M9XCJzdGFjay1ibG9jay1jYXJldFwiICpuZ0lmPVwiZXhwYW5kYWJsZVwiIFthdHRyLmRpcmVjdGlvbl09XCJjYXJldERpcmVjdGlvblwiPjwvY2RzLWljb24+XG4gICAgICA8c3BhbiBjbGFzcz1cImNsci1zci1vbmx5XCIgKm5nSWY9XCJnZXRDaGFuZ2VkVmFsdWVcIj57eyBjb21tb25TdHJpbmdzLmtleXMuc3RhY2tWaWV3Q2hhbmdlZCB9fTwvc3Bhbj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdGFjay12aWV3LWtleVwiPlxuICAgICAgICA8IS0tIFRoaXMgc3RydWN0dXJlIGNoYW5nZWQgdG8gZml4ICMzNTY3IGFuZCB0aGUgYTExeSByZXF1ZXN0IHdhcyB0byBtb3ZlIGF3YXkgZnJvbSBkbCdzIC0tPlxuICAgICAgICA8IS0tIEkgYWRkZWQgdGhlIGtleSBjbGFzcyB0byB1cGRhdGUgY3NzIHRhcmdldHMgZm9yIHRoZSBvcmlnaW5hbCBjb21wb25lbnQgc3R5bGUgLS0+XG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cImNsci1zdGFjay1sYWJlbFwiPjwvbmctY29udGVudD5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cInN0YWNrLWJsb2NrLWNvbnRlbnRcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8Y2xyLWV4cGFuZGFibGUtYW5pbWF0aW9uIFtjbHJFeHBhbmRUcmlnZ2VyXT1cImV4cGFuZGVkXCIgY2xhc3M9XCJzdGFjay1jaGlsZHJlblwiIFthdHRyLmlkXT1cImdldFN0YWNrQ2hpbGRyZW5JZCgpXCI+XG4gICAgICA8ZGl2IFtzdHlsZS5oZWlnaHRdPVwiZXhwYW5kZWQgPyAnYXV0bycgOiAwXCIgcm9sZT1cInJlZ2lvblwiICpuZ0lmPVwiZXhwYW5kZWRcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiY2xyLXN0YWNrLWJsb2NrXCI+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgPC9jbHItZXhwYW5kYWJsZS1hbmltYXRpb24+XG4gIGAsXG4gIC8vIEN1c3RvbSBlbGVtZW50cyBhcmUgaW5saW5lIGJ5IGRlZmF1bHRcbiAgc3R5bGVzOiBbXG4gICAgYFxuICAgICAgOmhvc3Qge1xuICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgIH1cbiAgICBgLFxuICBdLFxuICAvLyBNYWtlIHN1cmUgdGhlIGhvc3QgaGFzIHRoZSBwcm9wZXIgY2xhc3MgZm9yIHN0eWxpbmcgcHVycG9zZXNcbiAgaG9zdDogeyAnW2NsYXNzLnN0YWNrLWJsb2NrXSc6ICd0cnVlJyB9LFxuICBwcm92aWRlcnM6IFtVTklRVUVfSURfUFJPVklERVJdLFxufSlcbmV4cG9ydCBjbGFzcyBDbHJTdGFja0Jsb2NrIGltcGxlbWVudHMgT25Jbml0IHtcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zdGFjay1ibG9jay1leHBhbmRlZCcpXG4gIEBJbnB1dCgnY2xyU2JFeHBhbmRlZCcpXG4gIGV4cGFuZGVkID0gZmFsc2U7XG4gIEBPdXRwdXQoJ2NsclNiRXhwYW5kZWRDaGFuZ2UnKSBleHBhbmRlZENoYW5nZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPihmYWxzZSk7XG4gIEBIb3N0QmluZGluZygnY2xhc3Muc3RhY2stYmxvY2stZXhwYW5kYWJsZScpXG4gIEBJbnB1dCgnY2xyU2JFeHBhbmRhYmxlJylcbiAgZXhwYW5kYWJsZSA9IGZhbHNlO1xuXG4gIGZvY3VzZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfY2hhbmdlZENoaWxkcmVuID0gMDtcbiAgcHJpdmF0ZSBfZnVsbHlJbml0aWFsaXplZCA9IGZhbHNlO1xuICBwcml2YXRlIF9jaGFuZ2VkID0gZmFsc2U7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zdGFjay1ibG9jay1jaGFuZ2VkJylcbiAgZ2V0IGdldENoYW5nZWRWYWx1ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fY2hhbmdlZCB8fCAodGhpcy5fY2hhbmdlZENoaWxkcmVuID4gMCAmJiAhdGhpcy5leHBhbmRlZCk7XG4gIH1cblxuICBASW5wdXQoJ2NsclNiTm90aWZ5Q2hhbmdlJylcbiAgc2V0IHNldENoYW5nZWRWYWx1ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2NoYW5nZWQgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLl9mdWxseUluaXRpYWxpemVkKSB7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5wYXJlbnQuX2NoYW5nZWRDaGlsZHJlbisrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wYXJlbnQuX2NoYW5nZWRDaGlsZHJlbi0tO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXB0aCBvZiB0aGUgc3RhY2sgdmlldyBzdGFydGluZyBmcm9tIDEgZm9yIGZpcnN0IGxldmVsXG4gICAqL1xuICBASW5wdXQoJ2NsclN0YWNrVmlld0xldmVsJykgYXJpYUxldmVsOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRvdGFsIG51bWJlciBvZiByb3dzIGluIGEgZ2l2ZW4gZ3JvdXBcbiAgICovXG4gIEBJbnB1dCgnY2xyU3RhY2tWaWV3U2V0c2l6ZScpIGFyaWFTZXRzaXplOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBwb3NpdGlvbiBvZiB0aGUgcm93IGluc2lkZSB0aGUgZ3JvdXBlZCBieSBsZXZlbCByb3dzXG4gICAqL1xuICBASW5wdXQoJ2NsclN0YWNrVmlld1Bvc2luc2V0JykgYXJpYVBvc2luc2V0OiBudW1iZXI7XG5cbiAgLypcbiAgICogVGhpcyB3b3VsZCBiZSBtb3JlIGVmZmljaWVudCB3aXRoIEBDb250ZW50Q2hpbGRyZW4sIHdpdGggdGhlIHBhcmVudCBDbHJTdGFja0Jsb2NrXG4gICAqIHF1ZXJ5aW5nIGZvciBjaGlsZHJlbiBTdGFja0Jsb2NrcywgYnV0IHRoaXMgZmVhdHVyZSBpcyBub3QgYXZhaWxhYmxlIHdoZW4gZG93bmdyYWRpbmdcbiAgICogdGhlIGNvbXBvbmVudCBmb3IgQW5ndWxhciAxLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgQFNraXBTZWxmKClcbiAgICBAT3B0aW9uYWwoKVxuICAgIHByaXZhdGUgcGFyZW50OiBDbHJTdGFja0Jsb2NrLFxuICAgIEBJbmplY3QoVU5JUVVFX0lEKSBwdWJsaWMgdW5pcXVlSWQ6IHN0cmluZyxcbiAgICBwdWJsaWMgY29tbW9uU3RyaW5nczogQ2xyQ29tbW9uU3RyaW5nc1NlcnZpY2VcbiAgKSB7XG4gICAgaWYgKHBhcmVudCkge1xuICAgICAgcGFyZW50LmFkZENoaWxkKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgLy8gaW4gb3JkZXIgdG8gYWNjZXNzIHRoZSBwYXJlbnQgQ2xyU3RhY2tCbG9jaydzIHByb3BlcnRpZXMsXG4gICAgLy8gdGhlIGNoaWxkIENsclN0YWNrQmxvY2sgaGFzIHRvIGJlIGZ1bGx5IGluaXRpYWxpemVkIGF0IGZpcnN0LlxuICAgIHRoaXMuX2Z1bGx5SW5pdGlhbGl6ZWQgPSB0cnVlO1xuICB9XG5cbiAgYWRkQ2hpbGQoKTogdm9pZCB7XG4gICAgdGhpcy5leHBhbmRhYmxlID0gdHJ1ZTtcbiAgfVxuXG4gIHRvZ2dsZUV4cGFuZCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5leHBhbmRhYmxlKSB7XG4gICAgICB0aGlzLmV4cGFuZGVkID0gIXRoaXMuZXhwYW5kZWQ7XG4gICAgICB0aGlzLmV4cGFuZGVkQ2hhbmdlLmVtaXQodGhpcy5leHBhbmRlZCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGNhcmV0RGlyZWN0aW9uKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kZWQgPyAnZG93bicgOiAncmlnaHQnO1xuICB9XG5cbiAgZ2V0IHJvbGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5leHBhbmRhYmxlID8gJ2J1dHRvbicgOiBudWxsO1xuICB9XG5cbiAgZ2V0IHRhYkluZGV4KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kYWJsZSA/ICcwJyA6IG51bGw7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm9uLWZvY3VzJylcbiAgZ2V0IG9uU3RhY2tMYWJlbEZvY3VzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmV4cGFuZGFibGUgJiYgIXRoaXMuZXhwYW5kZWQgJiYgdGhpcy5mb2N1c2VkO1xuICB9XG5cbiAgZ2V0IGFyaWFFeHBhbmRlZCgpOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5leHBhbmRhYmxlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuZXhwYW5kZWQgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICAgIH1cbiAgfVxuXG4gIGdldFN0YWNrQ2hpbGRyZW5JZCgpIHtcbiAgICByZXR1cm4gdGhpcy5leHBhbmRlZCA/IGBjbHItc3RhY2stY2hpbGRyZW4tJHt0aGlzLnVuaXF1ZUlkfWAgOiBudWxsO1xuICB9XG59XG4iXX0=