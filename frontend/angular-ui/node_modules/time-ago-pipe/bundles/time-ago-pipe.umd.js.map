{"version":3,"file":"time-ago-pipe.umd.js","sources":["time-ago-pipe/out/time-ago.pipe.ts"],"names":["Pipe","ChangeDetectorRef"],"mappings":"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","sourcesContent":["import {Pipe, PipeTransform, NgZone, ChangeDetectorRef, OnDestroy} from \"@angular/core\";\r\n@Pipe({\r\n\tname:'timeAgo',\r\n\tpure:false\r\n})\r\nexport class TimeAgoPipe implements PipeTransform, OnDestroy {\r\n\tprivate timer: number;\r\n\tconstructor(private changeDetectorRef: ChangeDetectorRef, private ngZone: NgZone) {}\r\n\ttransform(value:string) {\r\n\t\tthis.removeTimer();\r\n\t\tlet d = new Date(value);\r\n\t\tlet now = new Date();\r\n\t\tlet seconds = Math.round(Math.abs((now.getTime() - d.getTime())/1000));\r\n\t\tlet timeToUpdate = (Number.isNaN(seconds)) ? 1000 : this.getSecondsUntilUpdate(seconds) *1000;\r\n\t\tthis.timer = this.ngZone.runOutsideAngular(() => {\r\n\t\t\tif (typeof window !== 'undefined') {\r\n\t\t\t\treturn window.setTimeout(() => {\r\n\t\t\t\t\tthis.ngZone.run(() => this.changeDetectorRef.markForCheck());\r\n\t\t\t\t}, timeToUpdate);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n\t\tlet minutes = Math.round(Math.abs(seconds / 60));\r\n\t\tlet hours = Math.round(Math.abs(minutes / 60));\r\n\t\tlet days = Math.round(Math.abs(hours / 24));\r\n\t\tlet months = Math.round(Math.abs(days/30.416));\r\n\t\tlet years = Math.round(Math.abs(days/365));\r\n\t\tif (Number.isNaN(seconds)){\r\n\t\t\treturn '';\r\n\t\t} else if (seconds <= 45) {\r\n\t\t\treturn 'a few seconds ago';\r\n\t\t} else if (seconds <= 90) {\r\n\t\t\treturn 'a minute ago';\r\n\t\t} else if (minutes <= 45) {\r\n\t\t\treturn minutes + ' minutes ago';\r\n\t\t} else if (minutes <= 90) {\r\n\t\t\treturn 'an hour ago';\r\n\t\t} else if (hours <= 22) {\r\n\t\t\treturn hours + ' hours ago';\r\n\t\t} else if (hours <= 36) {\r\n\t\t\treturn 'a day ago';\r\n\t\t} else if (days <= 25) {\r\n\t\t\treturn days + ' days ago';\r\n\t\t} else if (days <= 45) {\r\n\t\t\treturn 'a month ago';\r\n\t\t} else if (days <= 345) {\r\n\t\t\treturn months + ' months ago';\r\n\t\t} else if (days <= 545) {\r\n\t\t\treturn 'a year ago';\r\n\t\t} else { // (days > 545)\r\n\t\t\treturn years + ' years ago';\r\n\t\t}\r\n\t}\r\n\tngOnDestroy(): void {\r\n\t\tthis.removeTimer();\r\n\t}\r\n\tprivate removeTimer() {\r\n\t\tif (this.timer) {\r\n\t\t\twindow.clearTimeout(this.timer);\r\n\t\t\tthis.timer = null;\r\n\t\t}\r\n\t}\r\n\tprivate getSecondsUntilUpdate(seconds:number) {\r\n\t\tlet min = 60;\r\n\t\tlet hr = min * 60;\r\n\t\tlet day = hr * 24;\r\n\t\tif (seconds < min) { // less than 1 min, update every 2 secs\r\n\t\t\treturn 2;\r\n\t\t} else if (seconds < hr) { // less than an hour, update every 30 secs\r\n\t\t\treturn 30;\r\n\t\t} else if (seconds < day) { // less then a day, update every 5 mins\r\n\t\t\treturn 300;\r\n\t\t} else { // update every hour\r\n\t\t\treturn 3600;\r\n\t\t}\r\n\t}\r\n}"]}