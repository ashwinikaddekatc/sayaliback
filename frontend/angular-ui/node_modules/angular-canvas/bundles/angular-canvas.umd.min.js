!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("angular-canvas",["exports","@angular/core","@angular/common","@angular/platform-browser"],e):e((t=t||self)["angular-canvas"]={},t.ng.core,t.ng.common,t.ng.platformBrowser)}(this,(function(t,e,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}Object.create;function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}Object.create;function a(t){return Array.from(t.values()).filter((function(t){return t&&!!t.draw}))}var p=function(){function t(t,e){var n=this;this.ngZone=t,this.config=e,this.componentSet=new Set,this.componentsDrawings=[],this.element=document.createElement("canvas"),this.element.style.position="absolute",this.context=this.element.getContext("2d"),this._height=this.element.height,this._width=this.element.width,this.ngZone.runOutsideAngular((function(){window.requestAnimationFrame((function(t){return n.draw(t)}))}))}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parentElement=t,this.subResizeEvent()},enumerable:!1,configurable:!0}),t.prototype.subResizeEvent=function(){var t=this;this._parentElement&&this.resizeObserver&&this.resizeObserver.unobserve(this._parentElement),this.resizeObserver=new ResizeObserver((function(e){var n=s(e,1)[0],o=window.devicePixelRatio||1,r=n.contentRect.width,i=n.contentRect.height;r&&i&&(r=parseInt(r,10),i=parseInt(i,10));var a=!1;t._width!==r&&(t._width=r,t.element.width=r*o,t.element.style.width=r+"px",a=!0),t._height!==i&&(t._height=i,t.element.height=i*o,t.element.style.height=i+"px",a=!0),a&&(1!==o&&t.context.scale(o,o),t.drawWithoutRequestAnimation())})),this.resizeObserver.observe(this._parentElement)},t.prototype.resetCanvasSize=function(){var t=window.devicePixelRatio||1;this.element.width=this._width*t,this.element.style.width=this._width+"px",this.element.height=this._height*t,this.element.style.height=this._height+"px"},t.prototype.destroy=function(){this.resizeObserver&&this._parentElement&&this.resizeObserver.unobserve(this._parentElement),this.componentSet.clear(),this.componentsDrawings=null,this.element&&this.element.remove()},t.prototype.addClass=function(t){this.element.setAttribute("class",t)},t.prototype.appendChild=function(t){t.onInit&&t.onInit(this.context),this.componentSet.add(t),this.componentsDrawings=a(this.componentSet),this.drawAll()},t.prototype.removeChild=function(t){t.onDestroy&&t.onDestroy(this.context),this.componentSet.delete(t),this.componentsDrawings=a(this.componentSet),this.drawAll()},t.prototype.insertBefore=function(t,e){this.componentSet.add(t),this.componentsDrawings=a(this.componentSet),this.drawAll()},t.prototype.recalculateElementsDraw=function(){this.componentsDrawings=a(this.componentSet)},t.prototype.removeAttribute=function(t,e){this.element.removeAttribute(t)},t.prototype.removeClass=function(t){this.element.classList.remove(t)},t.prototype.removeStyle=function(t,e){},t.prototype.setAttribute=function(t,e){this.element.setAttribute(t,e)},t.prototype.setNgAttribute=function(t,e,n){this.element.setAttribute(t,e)},t.prototype.setNgProperty=function(t,e){},t.prototype.setStyle=function(t,e,n){},t.prototype.setValue=function(t){},t.prototype.drawAll=function(t){var e=this;this.ngZone.runOutsideAngular((function(){e.requestId&&window.cancelAnimationFrame(e.requestId),e.requestId=window.requestAnimationFrame((function(n){e.draw(n,t),e.requestId=null}))}))},t.prototype.drawWithoutRequestAnimation=function(){var t=this;this.ngZone.runOutsideAngular((function(){t.draw(0,!1),t.requestId=null}))},t.prototype.draw=function(t,e){var n=this;void 0===e&&(e=!0);var o=this.context;e&&o.clearRect(0,0,this.width,this.height);var r=!1,i=this.componentsDrawings&&this.componentsDrawings.length;if(i){for(var s=0;s<i;s++)this.componentsDrawings[s].draw(o,t),r=r||this.componentsDrawings[s].needDraw;r&&(this.requestId&&window.cancelAnimationFrame(this.requestId),this.requestId=window.requestAnimationFrame((function(t){return n.draw(t)})))}},t}();p.nodeName="canvas";var u={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},c=/%COMP%/g,l="_nghost-%COMP%",h="_ngcontent-%COMP%";function d(t){return h.replace(c,t)}function f(t){return l.replace(c,t)}function y(t,e,n){for(var o=0;o<e.length;o++){var r=e[o];Array.isArray(r)?y(t,r,n):(r=r.replace(c,t),n.push(r))}return n}var m=window.ngDevMode,v=void 0===m||!!m;function w(t){return function(e){if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var g=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(u[e]||e,t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore(e,n)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'+t+'" did not match any elements');return e||(n.textContent=""),n},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,n,o){if(o){e=o+":"+e;var r=u[o];r?t.setAttributeNS(r,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.removeAttribute=function(t,e,n){if(n){var o=u[n];o?t.removeAttributeNS(o,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,n,o,r){r&(e.RendererStyleFlags2.DashCase|e.RendererStyleFlags2.Important)?t.style.setProperty(n,o,r&e.RendererStyleFlags2.Important?"important":""):t.style[n]=o},t.prototype.removeStyle=function(t,n,o){o&e.RendererStyleFlags2.DashCase?t.style.removeProperty(n):t.style[n]=""},t.prototype.setProperty=function(t,e,n){v&&b(e,"property"),t[e]=n},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,n){return v&&b(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,w(n)):this.eventManager.addEventListener(t,e,w(n))},t}(),S="@".charCodeAt(0);function b(t,e){if(t.charCodeAt(0)===S)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var C=function(t){function e(e,n,o,r){var i=t.call(this,e)||this;i.component=o;var s=y(r+"-"+o.id,o.styles,[]);return n.addStyles(s),i.contentAttr=d(r+"-"+o.id),i.hostAttr=f(r+"-"+o.id),i}return i(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,n){var o=t.prototype.createElement.call(this,e,n);return t.prototype.setAttribute.call(this,o,this.contentAttr,""),o},e}(g),A=function(t){function n(n,o,r,i){var s=t.call(this,n)||this;s.sharedStylesHost=o,s.hostEl=r,s.component=i,i.encapsulation===e.ViewEncapsulation.ShadowDom?s.shadowRoot=r.attachShadow({mode:"open"}):s.shadowRoot=r.createShadowRoot(),s.sharedStylesHost.addHost(s.shadowRoot);for(var a=y(i.id,i.styles,[]),p=0;p<a.length;p++){var u=document.createElement("style");u.textContent=a[p],s.shadowRoot.appendChild(u)}return s}return i(n,t),n.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},n.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},n.prototype.appendChild=function(e,n){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),n)},n.prototype.insertBefore=function(e,n,o){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),n,o)},n.prototype.removeChild=function(e,n){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),n)},n.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},n}(g);function R(){return window.canvasRendererMetadataArgsStorage||(window.canvasRendererMetadataArgsStorage=new E),window.canvasRendererMetadataArgsStorage}var E=function(){this.elements=new Map},_=new e.InjectionToken("CanvasRenderConfig"),x=function(){function t(t,e,n,o,r){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.ngZone=o,this.canvasConfig=r,this.rendererByCompId=new Map,this.defaultRenderer=new g(t)}return t.prototype.end=function(){},t.prototype.createRenderer=function(t,n){if(!t||!n)return this.defaultRenderer;if(n.type&&n.type.isCanvasComponent)return(o=this.rendererByCompId.get(n.id))||(o=new O(this.eventManager,this.sharedStylesHost,n,this.appId,this.ngZone,this.canvasConfig),this.rendererByCompId.set(n.id,o)),o.applyToHost(t),o;switch(n.encapsulation){case e.ViewEncapsulation.Emulated:var o;return(o=this.rendererByCompId.get(n.id))||(o=new C(this.eventManager,this.sharedStylesHost,n,this.appId),this.rendererByCompId.set(n.id,o)),o.applyToHost(t),o;case e.ViewEncapsulation.ShadowDom:return new A(this.eventManager,this.sharedStylesHost,t,n);default:if(!this.rendererByCompId.has(n.id)){var r=y(n.id,n.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(n.id,this.defaultRenderer)}return this.defaultRenderer}},t}();x.decorators=[{type:e.Injectable}],x.ctorParameters=function(){return[{type:o.EventManager},{type:o.ɵDomSharedStylesHost},{type:String},{type:e.NgZone},{type:void 0,decorators:[{type:e.Inject,args:[_]}]}]};var O=function(){function t(t,e,n,o,r,i){this.component=n,this.ngZone=r,this.config=i,this.canvasElements=R().elements;var s=y(o+"-"+n.id,n.styles,[]);e.addStyles(s),this.contentAttr=d(o+"-"+n.id),this.hostAttr=f(o+"-"+n.id)}return t.prototype.applyToHost=function(t){this.setAttribute(t,this.hostAttr,"")},t.prototype.createElement=function(t,e){var n=this.canvasElements.get(t);if(n)return new n;if("canvas"===t){var o=new p(this.ngZone,this.config);return o.element.setAttribute(this.contentAttr,""),o}var r=void 0;return r=e?document.createElementNS(u[e]||e,t):document.createElement(t),this.setAttribute(r,this.contentAttr,""),r},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.selectRootElement=function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'+t+'" did not match any elements');return e||(n.textContent=""),n},t.prototype.addClass=function(t,e){t.classList?t.classList.add(e):t.addClass(e)},t.prototype.removeClass=function(t,e){t.classList?t.classList.add(e):t.removeClass(e)},t.prototype.appendChild=function(t,e){e&&(e.parent=t,e instanceof p?t.appendChild(e.element):t.appendChild(e))},t.prototype.removeChild=function(t,e){e.destroy&&e.destroy(),t&&t.removeChild(e),e&&e.parent instanceof p&&e.parent.removeChild(e)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.destroy=function(){},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore&&(e.parent=t,e instanceof p?t.insertBefore(e.element,n):t.insertBefore(e,n))},t.prototype.listen=function(t,e,n){var o=function(e){return n.call(t,e)};return t instanceof p&&(t=t.element),t.addEventListener(e,o),function(){return t.removeEventListener(e,o)}},t.prototype.nextSibling=function(t){return{previous:t,next:t.nextSibling}},t.prototype.parentNode=function(t){return t.parent?t.parent:t},t.prototype.removeAttribute=function(t,e,n){if(n){var o=u[n];o?t.removeAttributeNS(o,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.removeStyle=function(t,e,n){t.removeStyle(e,n)},t.prototype.setAttribute=function(t,e,n,o){if(o){e=o+":"+e;var r=u[o];r?t.setAttributeNS(r,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.setProperty=function(t,e,n){t.setNgProperty(e,n)},t.prototype.setStyle=function(t,n,o,r){t.style?r&e.RendererStyleFlags2.DashCase?t.style.setProperty(n,o,r&e.RendererStyleFlags2.Important?"important":""):t.style[n]=o:t.setStyle(n,o,r)},t.prototype.setValue=function(t,e){t.setValue?t.setValue(e):t.nodeValue=e},t}(),I=function(){function t(){}return t.forRoot=function(e){return{ngModule:t}},t}();I.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],providers:[{provide:e.RendererFactory2,useClass:x,deps:[o.EventManager,o.ɵDomSharedStylesHost,e.APP_ID,e.NgZone]}],schemas:[e.NO_ERRORS_SCHEMA]}]}],t.CanvasComponent=function(t){t.isCanvasComponent=!0},t.CanvasDomModule=I,t.CanvasDomRendererFactory=x,t.CanvasElement=function(t){return function(e){R().elements.set(t.selector,e)}},t.CanvasRenderer=O,t.MetadataArgsStorage=E,t.NgCanvas=p,t.getMetadataArgsStorage=R,t.ɵb=_,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-canvas.umd.min.js.map